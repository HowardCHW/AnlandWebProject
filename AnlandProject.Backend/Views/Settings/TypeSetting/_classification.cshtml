
<div class="panel panel-bordered col-md-12">
    <div class="row">
        <!-- 最新消息 -->
        <div class="col-md-6">
            <div class="panel-heading">
                <h3 class="panel-title">分類設定 - 最新消息</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-xl-6">
                        <a href="#editclass" class="btn btn-md btn-primary" style="margin-right:20px;" data-toggle="modal" datatype="NC">
                            <i class="icon wb-plus" aria-hidden="true"></i> 新增分類
                        </a>
                    </div>
                    <div class="form-group col-xl-3"> </div>
                </div>
                <div class="table-responsive">
                    <table id="nctable" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">類別代號</th>
                                <th class="text-center">類別名稱</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <!-- /最新消息-->
        <!-- 法令新訊 -->
        <div class="col-md-6">
            <div class="panel-heading">
                <h3 class="panel-title">分類設定 - 法令新訊</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-xl-6">
                        <a href="#editclass" class="btn btn-md btn-primary" style="margin-right:20px;" data-toggle="modal" datatype="LC">
                            <i class="icon wb-plus" aria-hidden="true"></i> 新增分類
                        </a>
                    </div>
                    <div class="form-group col-xl-3"> </div>
                </div>
                <div class="table-responsive">
                    <table id="lctable" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">類別代號</th>
                                <th class="text-center">類別名稱</th>
                                <th>操作</th>
                            </tr>
                        </thead>                        
                    </table>
                </div>                
            </div>
        </div>
        <!-- /法令新訊 -->
    </div>
</div>
<div class="panel panel-bordered col-md-12">
    <div class="row">
        <!-- Q & A 類別 -->
        <div class=" col-md-6">
            <div class="panel-heading">
                <h3 class="panel-title">分類設定 - Q & A 類別</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-xl-6">
                        <a href="#editclass" class="btn btn-md btn-primary" style="margin-right:20px;" data-toggle="modal" datatype="QC">
                            <i class="icon wb-plus" aria-hidden="true"></i> 新增分類
                        </a>
                    </div>
                    <div class="form-group col-xl-3"> </div>
                </div>
                <div class="table-responsive">
                    <table id="qctable" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">類別代號</th>
                                <th class="text-center">類別名稱</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <!-- /Q & A 類別 -->
        <!-- 公佈欄 -->
        <div class="col-md-6">
            <div class="panel-heading">
                <h3 class="panel-title">分類設定 - 公佈欄</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-xl-6">
                        <a href="#editclass" class="btn btn-md btn-primary" style="margin-right:20px;" data-toggle="modal" datatype="BC">
                            <i class="icon wb-plus" aria-hidden="true"></i> 新增分類
                        </a>
                    </div>
                    <div class="form-group col-xl-3"> </div>
                </div>
                <div class="table-responsive">
                    <table id="bctable" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">類別代號</th>
                                <th class="text-center">類別名稱</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>                
            </div>
        </div>
        <!-- /公佈欄-->
    </div>
</div>
<div class="panel panel-bordered col-md-12">
    <div class="row">
        <!-- 會議紀錄 -->
        <div class="col-md-6">
            <div class="panel-heading">
                <h3 class="panel-title">分類設定 - 會議紀錄</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-xl-6">
                        <a href="#editclass" class="btn btn-md btn-primary" style="margin-right:20px;" data-toggle="modal" datatype="MC">
                            <i class="icon wb-plus" aria-hidden="true"></i> 新增分類
                        </a>
                    </div>
                    <div class="form-group col-xl-3"> </div>
                </div>
                <div class="table-responsive">
                    <table id="mctable" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">類別代號</th>
                                <th class="text-center">類別名稱</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>                
            </div>
        </div>
        <!-- /會議紀錄 -->
        <!-- 員工專區表單下載 -->
        <div class="col-md-6">
            <div class="panel-heading">
                <h3 class="panel-title">分類設定 - 員工專區表單下載</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="form-group col-xl-6">
                        <a href="#editclass" class="btn btn-md btn-primary" style="margin-right:20px;" data-toggle="modal" datatype="DC">
                            <i class="icon wb-plus" aria-hidden="true"></i> 新增分類
                        </a>
                    </div>
                    <div class="form-group col-xl-3"> </div>
                </div>
                <div class="table-responsive">
                    <table id="dctable" class="table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">類別代號</th>
                                <th class="text-center">類別名稱</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <!-- /員工專區表單下載-->
    </div>
</div>

<!-- 最新消息 -->
<div class="modal fade" id="editclass" aria-labelledby="editclass" role="dialog" tabindex="-1" style="display: none;" aria-hidden="true">
    <div class="modal-dialog modal-simple modal-center">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 id="modalnewsTitle" class="modal-title">新增分類設定 - 最新消息</h4>
            </div>
            <form id="nceditForm" class="FullForm" autocomplete="off">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-control-label">
                            代號
                            <span class="required">*</span>
                        </label>
                        @Html.TextBox("classid", "", new { @class = "form-control", @placeholder = "請輸入代號", @required = "" })
                        @Html.Hidden("typeid")
                        @Html.Hidden("type")
                    </div>
                    <div class="form-group">
                        <label class="form-control-label">
                            類別名稱
                            <span class="required">*</span>
                        </label>
                        @Html.TextBox("classname", "", new { @class = "form-control", @placeholder = "請輸入類別名稱", @required = "" })
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="submit" class="btn btn-primary">確定</button>
                </div>
            </form>            
        </div>
    </div>
</div>
<!-- /最新消息 -->
<!-- DeleteModel -->
@Html.Action("ClassificationDeleteConfirmDialog", "TypeSetting")
<!-- /DeleteModel -->

<script>
    var urlQueryNewsClass = '@Url.Action("NewsClassQuery", "TypeSetting")';
    var urlQueryLawClass = '@Url.Action("LawClassQuery", "TypeSetting")';
    var urlQueryQaClass = '@Url.Action("QaClassQuery", "TypeSetting")';
    var urlQueryBoardClass = '@Url.Action("BoardClassQuery", "TypeSetting")';
    var urlQueryMeetingClass = '@Url.Action("MeetingClassQuery", "TypeSetting")';
    var urlQueryDocClass = '@Url.Action("DocumentClassQuery", "TypeSetting")';
    var urlSaveClass = '@Url.Action("ClassificationSave", "TypeSetting")';

    $(document).ready(function () {
        NCBinding();
        LCBinding();
        QCBinding();
        BCBinding();
        MCBinding();
        DCBinding();

        $('#nctable,#lctable,#qctable,#bctable,#mctable,#dctable').on('click', '#NCModal,#LCModal,#QCModal,#BCModal,#MCModal,#DCModal', function () {
            var tds = $(this).parent().siblings();
            $('#nceditForm input[name=typeid]').val($(this).attr('typeid'));
            $('#nceditForm input[name=classid]').val(tds[0].innerText);
            $('#nceditForm input[name=classname]').val(tds[1].innerText);
        });

        $('#editclass').on('shown.bs.modal', function (e) {
            var titleStr = '';
            var typeStr = e.relatedTarget.getAttribute('datatype');
            switch (typeStr) {
                case 'NC':
                    titleStr = '分類設定 - 最新消息';
                    break;
                case 'LC':
                    titleStr = '分類設定 - 法令新訊';
                    break;
                case 'QC':
                    titleStr = '分類設定 - Q&A類別';
                    break;
                case 'BC':
                    titleStr = '分類設定 - 公佈欄';
                    break;
                case 'MC':
                    titleStr = '分類設定 - 會議紀錄';
                    break;
                case 'DC':
                    titleStr = '分類設定 - 員工專區表單下載';
                    break;
                default:
            }

            var editStr = '新增';
            if ($('#nceditForm input[name=typeid]').val().length > 0) {
                editStr = '編輯';
            }
            $('#modalnewsTitle').html(editStr + titleStr);
            $('#nceditForm input[name=type]').val(typeStr);
            $('#nceditForm').formValidation('resetForm', false);
        });

        $('#editclass').on('hidden.bs.modal', function () {
            $('#nceditForm input[name=typeid]').val('');
            $('#nceditForm input[name=classid]').val('');
            $('#nceditForm input[name=classname]').val('');
        });

        $('#nceditForm').formValidation({
            framework: "bootstrap4",
            icon: null,
            fields: {
                classid: {
                    validators: {
                        notEmpty: {
                            message: '請輸入代號'
                        }
                    }
                },
                classname: {
                    validators: {
                        notEmpty: {
                            message: '請輸入類別名稱'
                        }
                    }
                }
            },
            err: {
                clazz: 'invalid-feedback'
            },
            control: {
                // The CSS class for valid control
                valid: 'is-valid',

                // The CSS class for invalid control
                invalid: 'is-invalid'
            },
            row: {
                invalid: 'has-danger'
            }
        })
            .on('success.form.fv', function (e) {
                // Prevent form submission
                e.preventDefault();

                // Use Ajax to submit form data
                $.ajax({
                    url: urlSaveClass,
                    type: "post",
                    headers: {
                        'RequestVerificationToken': '@CommonRazorFunctions.GetAntiForgeryToken()'
                    },
                    data: {
                        ID: $('#nceditForm input[name=typeid]').val(),
                        ClassID: $('#nceditForm input[name=classid]').val(),
                        ClassName: $('#nceditForm input[name=classname]').val(),
                        Type: $('#nceditForm input[name=type]').val()
                    },
                    dataType: 'json',
                    success: function (result) {
                        if (result) {
                            $('#editclass').modal('toggle');
                            var url = '/TypeSetting';
                            if ($('#nceditForm input[name=typeid]').val() > 0) {
                                SuccessMSGAfterAction("更新成功", url, 1000);
                            } else {
                                SuccessMSGAfterAction("新增成功", url, 1000);
                            }
                        } else {
                            ErrorMSG('異動失敗');
                        }
                    }
                });
            });
    });


    function NCBinding() {
        var _tmpOpts = $.extend({}, pfnDataTable.defOpts);
        _tmpOpts.ajax = {
            "url": urlQueryNewsClass,            
            "type": 'POST'
        };
        _tmpOpts.columns = [
            { mDataProp: "ClassID", className: 'text-center' },
            { mDataProp: "ClassName", className: 'text-center' },
            {
                mDataProp: null,
                render: function (data, type, full, meta) {
                    var tag =
                        '<a href="#editclass" id="NCModal" class="btn btn-pure btn-default p-5 btn-primary" typeid = "' + data.ID + '" data-toggle="modal" datatype="NC" >' +
                        '<span class="icon wb-pencil" data - toggle="tooltip" data - placement="top" data - original - title="編輯" ></span >' +
                        '</a >' +
                        '<a href="#ClassificationDeleteConfirmDialog" class="btn btn-pure btn-default p-5 btn-warning" data-contentargs="[&quot;' + data.ClassID + '-' + data.ClassName + '&quot;]" data-id="' + data.ID + '" data-type="NC" data-toggle="modal">' +
                        '<span class=" icon wb-trash" data-toggle="tooltip" data-placement="top" data-original-title="刪除"></span>' +
                        '</a>'
                    return tag;
                }
            }
        ];

        if ($.fn.DataTable.isDataTable('#nctable')) {
            $('#nctable').DataTable().destroy();
            $('#nctable  tbody tr').remove();
        }
        $('#nctable').DataTable(_tmpOpts);
    }

    function LCBinding() {
        var _tmpOpts = $.extend({}, pfnDataTable.defOpts);
        _tmpOpts.ajax = {
            "url": urlQueryLawClass,            
            "type": 'POST'
        };
        _tmpOpts.columns = [
            { mDataProp: "ClassID", className: 'text-center' },
            { mDataProp: "ClassName", className: 'text-center' },
            {
                mDataProp: null,
                render: function (data, type, full, meta) {
                    var tag =
                        '<a href="#editclass" id="LCModal" class="btn btn-pure btn-default p-5 btn-primary" typeid = "' + data.ID + '" data-toggle="modal" datatype="LC" >' +
                        '<span class="icon wb-pencil" data - toggle="tooltip" data - placement="top" data - original - title="編輯" ></span >' +
                        '</a >' +
                        '<a href="#ClassificationDeleteConfirmDialog" class="btn btn-pure btn-default p-5 btn-warning" data-contentargs="[&quot;' + data.ClassID + '-' + data.ClassName + '&quot;]" data-id="' + data.ID + '" data-type="LC" data-toggle="modal">' +
                        '<span class=" icon wb-trash" data-toggle="tooltip" data-placement="top" data-original-title="刪除"></span>' +
                        '</a>'
                    return tag;
                }
            }
        ];

        if ($.fn.DataTable.isDataTable('#lctable')) {
            $('#lctable').DataTable().destroy();
            $('#lctable  tbody tr').remove();
        }
        $('#lctable').DataTable(_tmpOpts);
    }

    function QCBinding() {
        var _tmpOpts = $.extend({}, pfnDataTable.defOpts);
        _tmpOpts.ajax = {
            "url": urlQueryQaClass,
            "type": 'POST'
        };
        _tmpOpts.columns = [
            { mDataProp: "ClassID", className: 'text-center' },
            { mDataProp: "ClassName", className: 'text-center' },
            {
                mDataProp: null,
                render: function (data, type, full, meta) {
                    var tag =
                        '<a href="#editclass" id="QCModal" class="btn btn-pure btn-default p-5 btn-primary" typeid = "' + data.ID + '" data-toggle="modal" datatype="QC" >' +
                        '<span class="icon wb-pencil" data - toggle="tooltip" data - placement="top" data - original - title="編輯" ></span >' +
                        '</a >' +
                        '<a href="#ClassificationDeleteConfirmDialog" class="btn btn-pure btn-default p-5 btn-warning" data-contentargs="[&quot;' + data.ClassID + '-' + data.ClassName + '&quot;]" data-id="' + data.ID + '" data-type="QC" data-toggle="modal">' +
                        '<span class=" icon wb-trash" data-toggle="tooltip" data-placement="top" data-original-title="刪除"></span>' +
                        '</a>'
                    return tag;
                }
            }
        ];

        if ($.fn.DataTable.isDataTable('#qctable')) {
            $('#qctable').DataTable().destroy();
            $('#qctable  tbody tr').remove();
        }
        $('#qctable').DataTable(_tmpOpts);
    }

    function BCBinding() {
        var _tmpOpts = $.extend({}, pfnDataTable.defOpts);
        _tmpOpts.ajax = {
            "url": urlQueryBoardClass,
            "type": 'POST'
        };
        _tmpOpts.columns = [
            { mDataProp: "ClassID", className: 'text-center' },
            { mDataProp: "ClassName", className: 'text-center' },
            {
                mDataProp: null,
                render: function (data, type, full, meta) {
                    var tag =
                        '<a href="#editclass" id="BCModal" class="btn btn-pure btn-default p-5 btn-primary" typeid = "' + data.ID + '" data-toggle="modal" datatype="BC" >' +
                        '<span class="icon wb-pencil" data - toggle="tooltip" data - placement="top" data - original - title="編輯" ></span >' +
                        '</a >' +
                        '<a href="#ClassificationDeleteConfirmDialog" class="btn btn-pure btn-default p-5 btn-warning" data-contentargs="[&quot;' + data.ClassID + '-' + data.ClassName + '&quot;]" data-id="' + data.ID + '" data-type="BC" data-toggle="modal">' +
                        '<span class=" icon wb-trash" data-toggle="tooltip" data-placement="top" data-original-title="刪除"></span>' +
                        '</a>'
                    return tag;
                }
            }
        ];

        if ($.fn.DataTable.isDataTable('#bctable')) {
            $('#bctable').DataTable().destroy();
            $('#bctable  tbody tr').remove();
        }
        $('#bctable').DataTable(_tmpOpts);
    }

    function MCBinding() {
        var _tmpOpts = $.extend({}, pfnDataTable.defOpts);
        _tmpOpts.ajax = {
            "url": urlQueryMeetingClass,
            "type": 'POST'
        };
        _tmpOpts.columns = [
            { mDataProp: "ClassID", className: 'text-center' },
            { mDataProp: "ClassName", className: 'text-center' },
            {
                mDataProp: null,
                render: function (data, type, full, meta) {
                    var tag =
                        '<a href="#editclass" id="MCModal" class="btn btn-pure btn-default p-5 btn-primary" typeid = "' + data.ID + '" data-toggle="modal" datatype="MC" >' +
                        '<span class="icon wb-pencil" data - toggle="tooltip" data - placement="top" data - original - title="編輯" ></span >' +
                        '</a >' +
                        '<a href="#ClassificationDeleteConfirmDialog" class="btn btn-pure btn-default p-5 btn-warning" data-contentargs="[&quot;' + data.ClassID + '-' + data.ClassName + '&quot;]" data-id="' + data.ID + '" data-type="MC" data-toggle="modal">' +
                        '<span class=" icon wb-trash" data-toggle="tooltip" data-placement="top" data-original-title="刪除"></span>' +
                        '</a>'
                    return tag;
                }
            }
        ];

        if ($.fn.DataTable.isDataTable('#mctable')) {
            $('#mctable').DataTable().destroy();
            $('#mctable  tbody tr').remove();
        }
        $('#mctable').DataTable(_tmpOpts);
    }

    function DCBinding() {
        var _tmpOpts = $.extend({}, pfnDataTable.defOpts);
        _tmpOpts.ajax = {
            "url": urlQueryDocClass,
            "type": 'POST'
        };
        _tmpOpts.columns = [
            { mDataProp: "ClassID", className: 'text-center' },
            { mDataProp: "ClassName", className: 'text-center' },
            {
                mDataProp: null,
                render: function (data, type, full, meta) {
                    var tag =
                        '<a href="#editclass" id="DCModal" class="btn btn-pure btn-default p-5 btn-primary" typeid = "' + data.ID + '" data-toggle="modal" datatype="DC" >' +
                        '<span class="icon wb-pencil" data - toggle="tooltip" data - placement="top" data - original - title="編輯" ></span >' +
                        '</a >' +
                        '<a href="#ClassificationDeleteConfirmDialog" class="btn btn-pure btn-default p-5 btn-warning" data-contentargs="[&quot;' + data.ClassID + '-' + data.ClassName + '&quot;]" data-id="' + data.ID + '" data-type="DC" data-toggle="modal">' +
                        '<span class=" icon wb-trash" data-toggle="tooltip" data-placement="top" data-original-title="刪除"></span>' +
                        '</a>'
                    return tag;
                }
            }
        ];

        if ($.fn.DataTable.isDataTable('#dctable')) {
            $('#dctable').DataTable().destroy();
            $('#dctable  tbody tr').remove();
        }
        $('#dctable').DataTable(_tmpOpts);
    }
    
</script>